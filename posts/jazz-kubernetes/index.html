<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>&lt;Kubernetes: ä¸€ç¨®çˆµå£«å³èˆˆæ¼”å‡ºï¼> - Tachunn Publication</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Index å°è¨€ å‰è¨€ é å…ˆçŸ¥è­˜ å…¶å¯¦ä¸æ˜¯ Container Orchestrationï¼Ÿ kubernetes ç³»çµ±å’Œå…ƒä»¶è§£é‡‹ Datastore: etcd Policy Layer: API Server Business Logic: Controller Manager & Scheduler Scheduler Controller Node Agent: Kubelet Workflow çµè«– å¿ƒå¾— é™„éŒ„ï¼šchubby Families å°è¨€ é€™ç¯‡æ–‡ç« æœƒç¿»è­¯ä»‹ç´¹ <Core Kubernetes: Jazz Improv over Orchestration> é€™ç¯‡æ–‡ç« ï¼Œä¸»è¦è¬›è§£ kubernetes çš„é‹ä½œåŸç† (ä¸æ˜¯æ€éº¼ä½¿ç”¨å–” XD)ã€‚æ–‡ç« ä½œè€…æ˜¯ kubernetes ä¸‰ä½å‰µå§‹äººä¹‹ä¸€çš„ Joe Bedaï¼Œä»–ç”¨å¾ˆç²¾ç°¡çš„èªè¨€å’Œä¾‹å­ç‚ºæˆ‘å€‘åˆ†æ kubernetes é€™æ¨£çš„ç³»çµ±ã€‚
å‰è¨€ é€™ç¯‡æ–‡ç« æœƒä»”ç´°è¬›è§£ kubernetes å…§éƒ¨å¦‚ä½•é‹ä½œï¼Œä½œè€…ç›´æ¥åœ¨ç¬¬äºŒå¥è©±å°±èªªï¼Œå¦‚æœä½ æ˜¯éœ€è¦çŸ¥é“å¦‚ä½• Operate kubernetes çš„äºº (æ¯”å¦‚èªªå®‰è£æˆ–æ˜¯ç”¨ kubectl)ï¼Œæ˜¯ä¸éœ€è¦æ‡‚é€™äº›çš„ XDã€‚é€™ç¯‡æ–‡ç« çš„å—çœ¾ï¼Œæ˜¯çµ¦é‚£äº›æƒ³è¦æ·±å…¥äº†è§£ kubernetes å…§éƒ¨çš„äººçš„ã€‚
é å…ˆçŸ¥è­˜ ç”±æ–¼é€™ç¯‡æ–‡ç« æœƒæ¡ç”¨å¤§é‡ç¯‡å¹…çš„ kubernetes å°ˆæœ‰åè©ï¼Œæ‰€ä»¥è‡³å°‘å¸Œæœ›ä½ çŸ¥é“ä¸€äº› kubernetes çš„åè©çš„å®šç¾©ï¼Œä¾‹å¦‚
Pod Node Kubelet â€¦etc å…¶å¯¦ä¸æ˜¯ Container Orchestrationï¼Ÿ å¾ŒçºŒçš„ç¯‡å¹…æˆ‘å€‘æœƒä»‹ç´¹ kubernetes æ˜¯å¦‚ä½•é‹ä½œçš„ï¼Œä¸éä½œè€…å»å…ˆåšäº†ä¸€é»åè©ä¸Šçš„æ¾„æ¸…ã€‚å¦‚æœä½ å» Google æŸ¥ kubernetesï¼Œå¤šåŠæœƒå‘Šè¨´ä½  kubernetes æ˜¯ä¸€ç¨® Container Orchestrationï¼ŒOrchestration é€™å€‹è©åƒæ˜¯æœ‰ä¸€å€‹äº¤éŸ¿æ¨‚åœ˜çš„ä¸­å¿ƒæŒ‡æ®å®¶ï¼ŒæŒ‡æ®è‘—æ¨‚åœ˜çš„æ¼”å¥ã€‚"><meta property="og:image" content><meta property="og:title" content="<Kubernetes: ä¸€ç¨®çˆµå£«å³èˆˆæ¼”å‡ºï¼>"><meta property="og:description" content="Index å°è¨€ å‰è¨€ é å…ˆçŸ¥è­˜ å…¶å¯¦ä¸æ˜¯ Container Orchestrationï¼Ÿ kubernetes ç³»çµ±å’Œå…ƒä»¶è§£é‡‹ Datastore: etcd Policy Layer: API Server Business Logic: Controller Manager & Scheduler Scheduler Controller Node Agent: Kubelet Workflow çµè«– å¿ƒå¾— é™„éŒ„ï¼šchubby Families å°è¨€ é€™ç¯‡æ–‡ç« æœƒç¿»è­¯ä»‹ç´¹ <Core Kubernetes: Jazz Improv over Orchestration> é€™ç¯‡æ–‡ç« ï¼Œä¸»è¦è¬›è§£ kubernetes çš„é‹ä½œåŸç† (ä¸æ˜¯æ€éº¼ä½¿ç”¨å–” XD)ã€‚æ–‡ç« ä½œè€…æ˜¯ kubernetes ä¸‰ä½å‰µå§‹äººä¹‹ä¸€çš„ Joe Bedaï¼Œä»–ç”¨å¾ˆç²¾ç°¡çš„èªè¨€å’Œä¾‹å­ç‚ºæˆ‘å€‘åˆ†æ kubernetes é€™æ¨£çš„ç³»çµ±ã€‚
å‰è¨€ é€™ç¯‡æ–‡ç« æœƒä»”ç´°è¬›è§£ kubernetes å…§éƒ¨å¦‚ä½•é‹ä½œï¼Œä½œè€…ç›´æ¥åœ¨ç¬¬äºŒå¥è©±å°±èªªï¼Œå¦‚æœä½ æ˜¯éœ€è¦çŸ¥é“å¦‚ä½• Operate kubernetes çš„äºº (æ¯”å¦‚èªªå®‰è£æˆ–æ˜¯ç”¨ kubectl)ï¼Œæ˜¯ä¸éœ€è¦æ‡‚é€™äº›çš„ XDã€‚é€™ç¯‡æ–‡ç« çš„å—çœ¾ï¼Œæ˜¯çµ¦é‚£äº›æƒ³è¦æ·±å…¥äº†è§£ kubernetes å…§éƒ¨çš„äººçš„ã€‚
é å…ˆçŸ¥è­˜ ç”±æ–¼é€™ç¯‡æ–‡ç« æœƒæ¡ç”¨å¤§é‡ç¯‡å¹…çš„ kubernetes å°ˆæœ‰åè©ï¼Œæ‰€ä»¥è‡³å°‘å¸Œæœ›ä½ çŸ¥é“ä¸€äº› kubernetes çš„åè©çš„å®šç¾©ï¼Œä¾‹å¦‚
Pod Node Kubelet â€¦etc å…¶å¯¦ä¸æ˜¯ Container Orchestrationï¼Ÿ å¾ŒçºŒçš„ç¯‡å¹…æˆ‘å€‘æœƒä»‹ç´¹ kubernetes æ˜¯å¦‚ä½•é‹ä½œçš„ï¼Œä¸éä½œè€…å»å…ˆåšäº†ä¸€é»åè©ä¸Šçš„æ¾„æ¸…ã€‚å¦‚æœä½ å» Google æŸ¥ kubernetesï¼Œå¤šåŠæœƒå‘Šè¨´ä½  kubernetes æ˜¯ä¸€ç¨® Container Orchestrationï¼ŒOrchestration é€™å€‹è©åƒæ˜¯æœ‰ä¸€å€‹äº¤éŸ¿æ¨‚åœ˜çš„ä¸­å¿ƒæŒ‡æ®å®¶ï¼ŒæŒ‡æ®è‘—æ¨‚åœ˜çš„æ¼”å¥ã€‚"><meta property="og:type" content="article"><meta property="og:url" content="https://tachunwu.github.io/posts/jazz-kubernetes/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-02T23:27:11+08:00"><meta property="article:modified_time" content="2023-02-02T23:27:11+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="<Kubernetes: ä¸€ç¨®çˆµå£«å³èˆˆæ¼”å‡ºï¼>"><meta name=twitter:description content="Index å°è¨€ å‰è¨€ é å…ˆçŸ¥è­˜ å…¶å¯¦ä¸æ˜¯ Container Orchestrationï¼Ÿ kubernetes ç³»çµ±å’Œå…ƒä»¶è§£é‡‹ Datastore: etcd Policy Layer: API Server Business Logic: Controller Manager & Scheduler Scheduler Controller Node Agent: Kubelet Workflow çµè«– å¿ƒå¾— é™„éŒ„ï¼šchubby Families å°è¨€ é€™ç¯‡æ–‡ç« æœƒç¿»è­¯ä»‹ç´¹ <Core Kubernetes: Jazz Improv over Orchestration> é€™ç¯‡æ–‡ç« ï¼Œä¸»è¦è¬›è§£ kubernetes çš„é‹ä½œåŸç† (ä¸æ˜¯æ€éº¼ä½¿ç”¨å–” XD)ã€‚æ–‡ç« ä½œè€…æ˜¯ kubernetes ä¸‰ä½å‰µå§‹äººä¹‹ä¸€çš„ Joe Bedaï¼Œä»–ç”¨å¾ˆç²¾ç°¡çš„èªè¨€å’Œä¾‹å­ç‚ºæˆ‘å€‘åˆ†æ kubernetes é€™æ¨£çš„ç³»çµ±ã€‚
å‰è¨€ é€™ç¯‡æ–‡ç« æœƒä»”ç´°è¬›è§£ kubernetes å…§éƒ¨å¦‚ä½•é‹ä½œï¼Œä½œè€…ç›´æ¥åœ¨ç¬¬äºŒå¥è©±å°±èªªï¼Œå¦‚æœä½ æ˜¯éœ€è¦çŸ¥é“å¦‚ä½• Operate kubernetes çš„äºº (æ¯”å¦‚èªªå®‰è£æˆ–æ˜¯ç”¨ kubectl)ï¼Œæ˜¯ä¸éœ€è¦æ‡‚é€™äº›çš„ XDã€‚é€™ç¯‡æ–‡ç« çš„å—çœ¾ï¼Œæ˜¯çµ¦é‚£äº›æƒ³è¦æ·±å…¥äº†è§£ kubernetes å…§éƒ¨çš„äººçš„ã€‚
é å…ˆçŸ¥è­˜ ç”±æ–¼é€™ç¯‡æ–‡ç« æœƒæ¡ç”¨å¤§é‡ç¯‡å¹…çš„ kubernetes å°ˆæœ‰åè©ï¼Œæ‰€ä»¥è‡³å°‘å¸Œæœ›ä½ çŸ¥é“ä¸€äº› kubernetes çš„åè©çš„å®šç¾©ï¼Œä¾‹å¦‚
Pod Node Kubelet â€¦etc å…¶å¯¦ä¸æ˜¯ Container Orchestrationï¼Ÿ å¾ŒçºŒçš„ç¯‡å¹…æˆ‘å€‘æœƒä»‹ç´¹ kubernetes æ˜¯å¦‚ä½•é‹ä½œçš„ï¼Œä¸éä½œè€…å»å…ˆåšäº†ä¸€é»åè©ä¸Šçš„æ¾„æ¸…ã€‚å¦‚æœä½ å» Google æŸ¥ kubernetesï¼Œå¤šåŠæœƒå‘Šè¨´ä½  kubernetes æ˜¯ä¸€ç¨® Container Orchestrationï¼ŒOrchestration é€™å€‹è©åƒæ˜¯æœ‰ä¸€å€‹äº¤éŸ¿æ¨‚åœ˜çš„ä¸­å¿ƒæŒ‡æ®å®¶ï¼ŒæŒ‡æ®è‘—æ¨‚åœ˜çš„æ¼”å¥ã€‚"><script src=https://tachunwu.github.io/js/feather.min.js></script>
<link href=https://tachunwu.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://tachunwu.github.io/css/main.ac08a4c9714baa859217f92f051deb58df2938ec352b506df655005dcaf98cc0.css></head><body><div class=content><header><script async src="https://www.googletagmanager.com/gtag/js?id=G-2LYZQ778V0"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-2LYZQ778V0")</script><div class=main><a href=https://tachunwu.github.io/>Tachunn Publication</a></div><nav><a href=/>Home</a>
<a href=/posts>All posts</a>
<a href=/about>About</a>
<a href=/tags>Tags</a></nav></header><main><article><div class=title><h1 class=title>&lt;Kubernetes: ä¸€ç¨®çˆµå£«å³èˆˆæ¼”å‡ºï¼></h1><div class=meta>Posted on Feb 2, 2023</div></div><section class=body><p><img src=/images/jazz-kubernetes_head.png alt><div><h2>Index</h2><nav id=TableOfContents><ol><li><a href=#å°è¨€><strong>å°è¨€</strong></a></li><li><a href=#å‰è¨€><strong>å‰è¨€</strong></a></li><li><a href=#é å…ˆçŸ¥è­˜><strong>é å…ˆçŸ¥è­˜</strong></a></li><li><a href=#å…¶å¯¦ä¸æ˜¯-container-orchestration><strong>å…¶å¯¦ä¸æ˜¯ Container Orchestrationï¼Ÿ</strong></a></li><li><a href=#kubernetes-ç³»çµ±å’Œå…ƒä»¶è§£é‡‹><strong>kubernetes ç³»çµ±å’Œå…ƒä»¶è§£é‡‹</strong></a><ol><li><a href=#datastore-etcd><strong>Datastore: etcd</strong></a></li><li><a href=#policy-layer-api-server><strong>Policy Layer: API Server</strong></a></li></ol></li><li><a href=#business-logic-controller-manager--scheduler><strong><strong>Business Logic: Controller Manager & Scheduler</strong></strong></a><ol><li><a href=#scheduler><strong>Scheduler</strong></a></li><li><a href=#controller><strong>Controller</strong></a></li><li><a href=#node-agent-kubelet><strong><strong>Node Agent: Kubelet</strong></strong></a></li></ol></li><li><a href=#workflow><strong>Workflow</strong></a></li><li><a href=#çµè«–><strong>çµè«–</strong></a></li><li><a href=#å¿ƒå¾—><strong>å¿ƒå¾—</strong></a></li><li><a href=#é™„éŒ„chubby-families><strong>é™„éŒ„ï¼šchubby Families</strong></a></li></ol></nav></div></p><h1 id=å°è¨€><strong>å°è¨€</strong></h1><p>é€™ç¯‡æ–‡ç« æœƒç¿»è­¯ä»‹ç´¹ &lt;<a href=https://blog.heptio.com/core-kubernetes-jazz-improv-over-orchestration-a7903ea92ca>Core Kubernetes: Jazz Improv over Orchestration</a>> é€™ç¯‡æ–‡ç« ï¼Œä¸»è¦è¬›è§£ <strong>kubernetes çš„é‹ä½œåŸç†</strong> (ä¸æ˜¯æ€éº¼ä½¿ç”¨å–” XD)ã€‚<a href>æ–‡ç« ä½œè€…æ˜¯ kubernetes ä¸‰ä½å‰µå§‹äººä¹‹ä¸€çš„ <strong>Joe Beda</strong></a>ï¼Œä»–ç”¨å¾ˆç²¾ç°¡çš„èªè¨€å’Œä¾‹å­ç‚ºæˆ‘å€‘åˆ†æ kubernetes é€™æ¨£çš„ç³»çµ±ã€‚</p><h1 id=å‰è¨€><strong>å‰è¨€</strong></h1><p>é€™ç¯‡æ–‡ç« æœƒä»”ç´°è¬›è§£ kubernetes å…§éƒ¨å¦‚ä½•é‹ä½œï¼Œ<a href>ä½œè€…ç›´æ¥åœ¨ç¬¬äºŒå¥è©±å°±èªªï¼Œå¦‚æœä½ æ˜¯éœ€è¦çŸ¥é“å¦‚ä½• Operate kubernetes çš„äºº (æ¯”å¦‚èªªå®‰è£æˆ–æ˜¯ç”¨ kubectl)ï¼Œæ˜¯ä¸éœ€è¦æ‡‚é€™äº›çš„ XDã€‚é€™ç¯‡æ–‡ç« çš„å—çœ¾ï¼Œæ˜¯çµ¦é‚£äº›æƒ³è¦æ·±å…¥äº†è§£ kubernetes å…§éƒ¨çš„äººçš„ã€‚</a></p><h1 id=é å…ˆçŸ¥è­˜><strong>é å…ˆçŸ¥è­˜</strong></h1><p>ç”±æ–¼é€™ç¯‡æ–‡ç« æœƒæ¡ç”¨å¤§é‡ç¯‡å¹…çš„ kubernetes å°ˆæœ‰åè©ï¼Œæ‰€ä»¥è‡³å°‘å¸Œæœ›ä½ çŸ¥é“ä¸€äº› <a href><strong>kubernetes çš„åè©çš„å®šç¾©</strong></a>ï¼Œä¾‹å¦‚</p><ul><li><strong>Pod</strong></li><li><strong>Node</strong></li><li><strong>Kubelet</strong></li><li><strong>â€¦etc</strong></li></ul><h1 id=å…¶å¯¦ä¸æ˜¯-container-orchestration><strong>å…¶å¯¦ä¸æ˜¯ Container Orchestrationï¼Ÿ</strong></h1><p>å¾ŒçºŒçš„ç¯‡å¹…æˆ‘å€‘æœƒä»‹ç´¹ kubernetes æ˜¯å¦‚ä½•é‹ä½œçš„ï¼Œä¸éä½œè€…å»å…ˆåšäº†ä¸€é»åè©ä¸Šçš„æ¾„æ¸…ã€‚<a href>å¦‚æœä½ å» Google æŸ¥ kubernetesï¼Œå¤šåŠæœƒå‘Šè¨´ä½  kubernetes æ˜¯ä¸€ç¨® <strong>Container Orchestration</strong></a>ï¼Œ<a href>Orchestration é€™å€‹è©<strong>åƒæ˜¯æœ‰ä¸€å€‹äº¤éŸ¿æ¨‚åœ˜çš„ä¸­å¿ƒæŒ‡æ®å®¶ï¼ŒæŒ‡æ®è‘—æ¨‚åœ˜çš„æ¼”å¥ã€‚</strong></a></p><p>é›–ç„¶æŸç¨®å±¤é¢ä¸Šä¾†èªª kubernetes æ˜¯ Container Orchestration æ²’æœ‰éŒ¯ï¼Œ<a href><strong>ä½†æ˜¯ä½œè€…è¦ºå¾—æ¯”å–»æˆ jazz improv æœƒæ›´ç‚ºæ°ç•¶ï¼</strong></a></p><h1 id=kubernetes-ç³»çµ±å’Œå…ƒä»¶è§£é‡‹><strong>kubernetes ç³»çµ±å’Œå…ƒä»¶è§£é‡‹</strong></h1><p><img src=/images/jazz-kubernetes_0.png alt></p><p>ä»¥ä¸Šé€™å¼µåœ–å°±æ˜¯ kubernetes çš„æ¦‚è¦½ã€‚</p><h2 id=datastore-etcd><strong>Datastore: etcd</strong></h2><p>etcd å¯ä»¥èªªæ˜¯ kubernetes çš„ state å¿ƒè‡Ÿï¼Œè² è²¬å„²å­˜æ‰€æœ‰ kubernetes æœ€é‡è¦çš„è³‡æ–™ã€‚</p><p>å°æ–¼ä¸ç†Ÿæ‚‰ etcd çš„äººï¼Œæˆ‘ç°¡å–®ç¸½çµä¸€ä¸‹å®ƒçš„è¨­è¨ˆï¼Œ<a href><strong>etcd æ˜¯ä¸€ç¨® distributed key-value database</strong>ï¼ŒæŠŠ consistency å„ªå…ˆæ–¼ partition toleranceã€‚</a></p><p><a href><em>è¨»è¨˜</em></a>ï¼šç‚ºäº†è®€è€…é–±è®€çš„é †æš¢æ€§ï¼Œå¤§å®¶å¯ä»¥æƒ³åƒ etcd æ˜¯è³‡æ–™åº«å°±å¥½ï¼Œæˆ‘æœƒæŠŠä½œè€…æœ‰é»é›¢é¡Œçš„éƒ¨åˆ†æ”¾åœ¨æ­¤æ–‡ç« æœ«çš„é™„éŒ„èªªæ˜ã€‚</p><h2 id=policy-layer-api-server><strong>Policy Layer: API Server</strong></h2><p>é€™å€‹å…ƒä»¶æ˜¯ kubernetes çš„å¿ƒè‡Ÿï¼Œ<strong>ä¹Ÿæ˜¯å”¯ä¸€æœƒå’Œ etcd æºé€šçš„å…ƒä»¶</strong>ã€‚äº‹å¯¦ä¸Šä½œè€…èªç‚ºï¼Œetcd å·²ç¶“ç®—æ˜¯å¯¦ä½œçš„ç´°ç¯€äº†ï¼Œ<a href><strong>ç†è«–ä¸Šæˆ‘å€‘ç”šè‡³å¯ä»¥æ›æ‰ etcd è®Šæˆå…¶ä»–çš„ storage systemã€‚</strong></a></p><p>API Server æœ¬èº«æ˜¯ policy componentï¼Œæœƒéæ¿¾è«‹æ±‚çš„å…§å®¹ï¼Œç¦æ­¢ä½ ç›´æ¥æ¥è§¸ etcdã€‚API Server ä¸»è¦åœç¹è‘— resourceï¼Œå°å¤–å°±æ˜¯ä¸€å€‹ç°¡å–®çš„ REST APIï¼Œ<a href><strong>ç°¡å–®ä¾†èªª API Server åªæœ‰åš create, read, write, update, watch ä¹‹é¡çš„ä»»å‹™</strong></a>ã€‚</p><p>æ¥è‘—æˆ‘å€‘èŠèŠ API Server æœ‰ä»€éº¼ç‰¹æ€§çš„ç´°ç¯€ã€‚</p><ol><li><a href><strong>Authentication and authorization</strong></a>ï¼š</li></ol><p>Kubernetes æœ‰ä¸€å€‹ pluggable çš„é©—è­‰ç³»çµ±ï¼Œé™¤äº†å…§éƒ¨çš„é©—è­‰æ–¹å¼ï¼Œé‚„æœ‰å¯ä»¥å¤–éƒ¨åŒ–çš„è¨—ç®¡æ–¹å¼ã€‚</p><ol start=2><li><a href><strong>Admission controllers</strong></a>ï¼š</li></ol><p>å…¶æ¬¡ï¼Œ API Server ä¸æœƒç…§å–®å…¨æ”¶è«‹æ±‚ï¼Œç•¶ client ç™¼å‡ºè«‹æ±‚ä¹‹å¾Œï¼Œæœƒå…ˆç¶“éå…§éƒ¨çš„æ”¿ç­–è¨ˆç®—ï¼Œ<strong>ç•¶ç„¶æˆ‘å€‘ä¹Ÿå¯ä»¥è—‰ç”±è‡ªå·±è¨­è¨ˆ controllers ä¾†æ“´å…… kubernetes æœ¬èº«çš„åŠŸèƒ½ã€‚</strong></p><ol start=3><li><a href><strong>API versioning</strong></a>ï¼š</li></ol><p>ç”±æ–¼ kubernetes æœ¬èº«çš„ç‰ˆæœ¬ä¸æ–·æ¨é€²ï¼ŒAPI Server æœ¬èº«ä¹Ÿè¦æ”¯æ´ä¸åŒç‰ˆæœ¬çš„ç”Ÿå‘½é€±æœŸï¼Œè‡³æ–¼è³‡æ–™å‰‡æ˜¯é  etcd ä¾†ä¿å­˜ã€‚</p><p><a href><strong>åœ¨ API Server ä¸­æœ€é‡è¦çš„åŠŸèƒ½å°±æ˜¯ watchï¼watch çš„æ„æ€æ˜¯ç•¶å…¶ä¸­ä¸€é …è³‡æºè¢«æ›´å‹•äº†ï¼Œæ­£åœ¨ watch é€™é …è³‡æºçš„å…ƒä»¶å¯ä»¥å¾—çŸ¥è¨Šæ¯ï¼Œç„¶å¾Œåšå‡ºç›¸å°æ‡‰çš„è¡Œç‚ºã€‚</strong></a></p><h1 id=business-logic-controller-manager--scheduler><strong><strong>Business Logic: Controller Manager & Scheduler</strong></strong></h1><p>è‡³æ–¼æœ€å¾Œä¸€ç‰‡æ‹¼åœ–å°±èƒ½è®“ kubernetes æ•´å€‹æ´»èµ·ä¾†ï¼<a href><strong>æˆ‘å€‘æœ‰å…©ç¨® Servers åœç¹ä½¿ç”¨ API Server</strong></a>ï¼Œå¥¹å€‘åˆ†åˆ¥æ˜¯ <a href><strong>Controller Manager</strong></a> å’Œ <a href><strong>Scheduler</strong></a>ã€‚ä½œè€…æåˆ°ï¼Œçš„ç¢ºå¯ä»¥æŠŠé€™äº›æ±è¥¿å…¨éƒ¨å¯«é€²å»ä¸€å€‹è¶…å¤§çš„ binary æª”æ¡ˆï¼Œä¸éåˆ†é–‹ä¾†è¨­è¨ˆä¹Ÿå°±ç‚ºäº†æœªä¾†çš„æ“´å±•æ€§åšå‡ºé‹ªè·¯çš„å‹•ä½œã€‚(é›–ç„¶ä½œè€…èªªé€™æ¨£è¨­è¨ˆæ˜¯ä¸€å€‹æ­·å²æ€§çš„æ„å¤– XD)</p><h2 id=scheduler><strong>Scheduler</strong></h2><p>ä¸»è¦è² è²¬é€™äº›å·¥ä½œï¼š</p><ol><li><strong>çœ‹ etcd ä¸­é‚£äº› Pods é‚„æ²’æœ‰è¢«å®‰æ’åˆ° Node ä¸Š</strong></li><li><strong>æª¢æŸ¥ cluster çš„ç‹€æ…‹</strong></li><li><strong>é¸ä¸€å€‹ nodeï¼Œç¬¦åˆè«‹æ±‚çš„é™åˆ¶</strong></li><li><strong>éƒ¨ç½² Pods åˆ° Node ä¸Šé¢</strong></li></ol><h2 id=controller><strong>Controller</strong></h2><p>åŒæ¨£çš„ Controller ä¹Ÿæœƒåšå’Œ Scheduler å·®ä¸å¤šçš„äº‹æƒ…ã€‚</p><ol><li><strong>é€é watch API Server å¾—çŸ¥ç›®å‰ cluster ç‹€æ…‹</strong></li><li><strong>åµæ¸¬åˆ°ç•°å¸¸ï¼Œç„¶å¾Œé‡æ–°ä½ˆç½² Pods</strong></li></ol><p>èˆ‰ä¾‹ä¾†èªªï¼šç•¶ä»Šå¤©ä½¿ç”¨è€…éƒ¨ç½²äº† ReplicaSet (ä¸€ç¨®ç¢ºä¿ç‰¹å®šæ•¸é‡çš„ Pods è³‡æº)ï¼Œå‡è¨­ä»Šå¤©æ˜¯è¨­å®šç‚º 3 å¥½äº†ï¼Œå› ç‚ºæ„å¤– Pod æ­»äº¡äº†è®Šæˆ 2ï¼ŒController æœƒ watch é€™å€‹è³‡æºï¼Œç„¶å¾Œé‡æ–°ä½ˆç½² Podï¼Œè®“ Pod æ•¸é‡ç©©å®šã€‚</p><h2 id=node-agent-kubelet><strong><strong>Node Agent: Kubelet</strong></strong></h2><p>åœ¨å·¥ä½œçš„ Node éƒ½æœƒæœ‰ä»£ç†ï¼Œå«åš Kubelet è² è²¬ç›£æ§å’Œèª¿åº¦é€™å€‹ Node çš„ç‹€æ…‹ï¼Œé™¤äº†ä¸€äº›åŸºæœ¬çš„å·¥ä½œï¼Œ<a href>æœ€ä¸»è¦å°±æ˜¯ watch è‡ªå·± Pods çš„è®ŠåŒ–ï¼Œä¸¦ä¸”å›å ± API Serverï¼Œä¸¦ä¸”è¦–æƒ…æ³ç®¡ç† Podsã€‚</a></p><h1 id=workflow><strong>Workflow</strong></h1><p>æ¥è‘—æˆ‘å€‘çœ‹çœ‹å¯¦éš›ä¸Šçš„é‹ä½œæµç¨‹å§ï¼</p><p><img src=/images/jazz-kubernetes_1.png alt></p><p>é€™æ˜¯ä¸€å€‹ user éƒ¨ç½²ä¸€å€‹ Pod çš„æµç¨‹ä¾‹å­ã€‚</p><ol><li><strong>é¦–å…ˆ user å…ˆæŠŠè«‹æ±‚ç™¼åˆ° API Serverï¼Œé©—è­‰éå¾Œå°±æœƒæŠŠé€™å€‹è³‡æºçš„ç‹€æ…‹å¯«åˆ° etcdã€‚</strong></li><li><strong>scheduler ä¸€ç›´ watch API Serverï¼Œæœƒç™¼ç¾ä¸€å€‹ â€œunboundâ€ çš„ Podï¼Œç¶“ç”± scheduler æ¼”ç®—æ³•æ±ºå®šå¥½éƒ¨ç½²è¨ˆç•«å¾Œï¼Œé€é API Server æŠŠè¨ˆç•«å¯«å› etcdã€‚</strong></li><li><strong>Kubelet åŒæ™‚ä¹Ÿä¸€ç›´ watch æœ‰ä»€éº¼æ–°çš„ Pods è¢«åˆ†é…åˆ°è‡ªå·±èº«ä¸Šï¼Œä¸€æ—¦ç™¼ç¾å°±é€é Docker æŠŠå®¹å™¨çµ¦å•Ÿå‹•ã€‚</strong></li><li><strong>Kubelet çš„ monitors æœƒä¸æ–·å›å ±çµ¦ API Server æ›´æ–°è£¡é¢çš„ cluster statesã€‚</strong></li></ol><h1 id=çµè«–><strong>çµè«–</strong></h1><p>kubernetes çš„ API Server å°±æ˜¯æ‰€æœ‰çš„ä¸­å¿ƒé»ï¼Œé›–ç„¶èªª wiki å’Œä¸€äº›æ–‡ä»¶éƒ½æœƒèªªæ˜¯ orchestrationï¼Œä½†æ˜¯<a href><strong>ä½œè€…æœƒèªç‚ºç”¨ jazz improv ä¾†å½¢å®¹æœƒæ›´åŠ è²¼åˆ‡ã€‚</strong></a></p><p><a href><strong>æˆ‘æƒ³æ˜¯å› ç‚ºçˆµå£«æ¨‚çš„æ¼”å¥ä¸¦ä¸åƒæ˜¯å¤§å®¶çœ‹è‘—åŒä¸€å¼µè­œæ¼”å¥è‡ªå·±çš„éƒ¨åˆ†ï¼Œè€Œæ˜¯æ ¹æ“šåˆ¥äººçš„æ¼”å¥ä¾†åˆ¤æ–·è‡ªå·±è©²å¦‚å³èˆˆæ¼”å‡ºï¼åœ¨ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘å€‘å¯ä»¥ç™¼ç¾å…¶å¯¦é€™å€‹æ¨¡å¼å’Œçˆµå£«æ¨‚çš„æ¼”å¥çœŸçš„æ¯”è¼ƒç›¸ä¼¼ï¼Œè¶…æœ‰è¶£çš„ï¼</strong></a></p><h1 id=å¿ƒå¾—><strong>å¿ƒå¾—</strong></h1><p>é€™ç¯‡çŸ­çŸ­çš„éƒ¨è½æ ¼ï¼Œç›¸æ¯”æ–¼ kubernetes å®˜ç¶²çš„æ–‡ä»¶å¯ä»¥èªªæ˜¯çŸ­çš„å¯ä»¥ï¼Œä½†æ˜¯å»èƒ½å•Ÿç™¼æˆ‘çš„å¾ˆå¤šæ€è€ƒï¼Œå…¶å¯¦é€™æ¨£çœ‹ä¾†æ•´å€‹ kubernetes æœ¬è³ªä¸Šæ˜¯ä¸€å€‹ Pub/Sub ç³»çµ±ï¼Œå…ƒä»¶å½¼æ­¤éƒ½åœ¨åšè‡ªå·±çš„äº‹æƒ…ï¼Œ<a href><strong>èˆ‡å…¶èªªæ˜¯ API Serverï¼Œæˆ‘æ›´è¦ºå¾—åƒæ˜¯ Message Queue çš„ Topic/Subjectã€‚</strong></a></p><p>å…¶ä¸­é‚„éš±è—äº†å…©å€‹é‡è¦çš„è§€å¿µä½œè€…æ²’æœ‰æåˆ°ï¼Œå°±æ˜¯ <a href><strong>Command å’Œ Event</strong></a>ã€‚</p><p><a href><strong>Command æœ¬èº«å°±åƒæ˜¯æ‰“ API ä¸€æ¨£ï¼Œå¯èƒ½æˆåŠŸå¯èƒ½å¤±æ•—ï¼›ä½†æ˜¯ Event å‰‡æ˜¯è¨˜éŒ„ä¸‹å·²ç¶“ç™¼ç”Ÿçš„äº‹æƒ…ï¼Œè¢«ä¿å­˜åœ¨ Disk ä¸Šäº†ï¼Œæ‰€ä»¥å¾ŒçºŒçš„å…ƒä»¶å¯ä»¥ä¾ç…§ Event ç¹¼çºŒåŸ·è¡Œæ•´å€‹ç³»çµ±çš„ä»»å‹™ã€‚</strong></a></p><p>èˆ‰ä¾‹ä¾†èªªï¼Œä¸Šé¢çš„æ•…äº‹ user ç™¼å®Œè«‹æ±‚ä¹‹å¾Œï¼Œæ±è¥¿è¢«å¯«å…¥ etcdï¼ŒAPI Server å°±æ›é»äº†ï¼Œä½†æ˜¯é‡å•Ÿä¹‹å¾Œå…¶ä»–äººé‚„æ˜¯èƒ½å¤ å¾ API Server â†’ etcd ç¹¼çºŒåŸ·è¡Œ user æƒ³è¦çš„éƒ¨ç½²è¡Œç‚ºã€‚æˆ‘æƒ³åˆ†æ•£å¼ç³»çµ±çš„é­…åŠ›å°±åœ¨æ­¤å§ï¼é€éä¸€äº›ç´€éŒ„å’Œé…åˆçš„ protocol å¯ä»¥å®Œæˆä¸€äº›çœ‹ä¼¼éå¸¸å›°é›£çš„ä»»å‹™ï¼</p><h1 id=é™„éŒ„chubby-families><strong>é™„éŒ„ï¼šchubby Families</strong></h1><p>é€™é‚Šå°±ä¾†èŠèŠ etcdï¼Œå°±åƒä¸Šé¢èªªçš„ <a href>etcd é€™ç¨®åˆ†æ•£å¼è³‡æ–™åº«æŠŠä¸€è‡´æ€§çš„å„ªå…ˆæ€§æ‹‰çš„å¾ˆé«˜</a>ï¼Œé€™é¡çš„ç³»çµ±å®¶æ—æœ‰ ZooKeeper å’Œä¸€éƒ¨åˆ†çš„ Consulï¼Œå®ƒå€‘çš„ç¥–å¸«çˆºæ˜¯ Google çš„ <a href=https://research.google.com/archive/chubby.html>chubby</a>ï¼Œ<a href>é€™å€‹å®¶æ—é€šç¨± â€œlock serversâ€ï¼Œä¸»è¦çš„ç›®çš„æ˜¯å”èª¿åˆ†æ•£å¼ç³»çµ±çš„ coordinate å’Œ locking å•é¡Œã€‚</a></p><p>å…¶å¯¦ä»”ç´°çœ‹ï¼Œä»–å€‘çš„ API è·Ÿ File system çš„è¨­è¨ˆå¾ˆåƒï¼Œæ ¹æœ¬åƒæ˜¯æ“ä½œ Fileï¼Œå°æ–¼ highly consistent å’Œ strict ordering çš„æ¥µåº¦è¦æ±‚è®“ä½¿ç”¨è€…å¯ä»¥å®‰å¿ƒåœ°ç”¨ atomic çš„æ“ä½œç‹€æ…‹æ©Ÿã€‚</p><p>ä½œè€…èªç‚ºï¼Œkubernetes å¾ˆå¤§ä¸€éƒ¨ä»½è¦æ„Ÿè¬ etcdï¼Œraft æˆ–æ˜¯ paxos éƒ½æ˜¯å¾ˆé›£çš„æ¼”ç®—æ³•ï¼Œç•¶ etcd æˆåŠŸå¯¦ä½œä¹‹å¾Œï¼Œkubernetes å¯ä»¥åŸºæ–¼æ­¤ä¹‹ä¸Šé–‹ç™¼å¾ˆå¤šæœ‰è¶£çš„æ±è¥¿ã€‚</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/engineering>Engineering</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/tachunwu rel=me title=GitHub><i data-feather=github></i></a>
<a class=border></a></div><div class=footer-info>2023 ğŸ’  Â© Tachunn | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script async src="https://www.googletagmanager.com/gtag/js?id=G-2LYZQ778V0"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-2LYZQ778V0")</script><script>feather.replace()</script></div></body></html>